---
layout: post
title: Chapter 2-4 트랜잭션 (Transaction)과 NULL
author: admin
date: 2023-08-25 21:10:00 +900
lastmod: 2023-08-25 21:10:00 +900
sitemap:
  changefreq: monthly
  priority: 0.5
categories: [DATABASE(DB), SQLD]  # 대문자로 작성
tags: [sql, sqld, data modeiling] # 소문자로 작성
---


> 해당 포스트는 `SQLD`를 학습하며 정리한 내용에 대한 포스트입니다.<br />
{:.prompt-info}

<br />

> 이론을 학습한 내용을 정리하고 퀴즈, 기출문제 등을 기록하려고 합니다.<br />
{:.prompt-tip}

<br />

# 🌈 **4. 트랜잭션 (Transaction)과 NULL**

## 💻 **4.1 트랜잭션 (Transaction)**

데이터를 조작하기 위한 하나의 논리적인 작업 단위 

트랜잭션을 이해하기 위해서는, 우리가 은행에서 돈을 인출하는 상황을 생각해보면 좋다. 

은행 계좌에서 돈을 인출하려면 먼저 현재 잔액이 충분한지 확인하고, 그 다음에 잔액에서 인출할 금액을 빼야 한다. 

이 두 가지 단계 모두가 완벽하게 수행되어야 돈이 제대로 인출된다. 

만약 중간에 문제가 생겨서 잔액 확인은 했지만, 실제로 금액을 빼는 단계에서 문제가 발생한다면 어떻게 될까? 

그럴 경우에는 처음부터 다시 시작해서 모든 단계를 올바르게 수행할 수 있도록 해야 한다. 이런 것이 바로 <span style="color:tomato"><strong >트랜잭션</strong></span>이 하는 일이다. 

데이터베이스에서 트랜잭션이라 함은 한 번에 여러 단계를 거쳐야 하는 작업들의 집합을 말한다. 

중간에 어디선가 문제가 생기면, 그 작업들은 모두 원래대로 돌려놓아야 하며(이를 `롤백(Rollback)`이라고 한다), 모든 작업이 성공적으로 마무리되면 그 변경사항들은 데이터베이스에 반영됩니다(이를 `커밋(Commit)`한다고 한다).

>**<span style="color:#3366ff">데이터베이스 트랜잭션</span>은 <span style="color:#ff6600">ACID라는 특성</span>을 가지고 있다.**

<br/>

## ⚡ **ACID** 

>**<span style="color:#3366ff">ACID</span>는 <span style="color:#ff6600">데이터베이스 내에서 일어나는 하나의 트랜잭션(transaction)의 안전성을 보장하기 위해 필요한 성질</span>이다.**

<br/>

![ACID image](https://github.com/leekoby/leekoby.github.io/assets/118284808/f6ec9858-c8d9-41fe-b7f0-ee8a06602406){: width="500" height="500" }

- Atomicity (원자성)
- Consistency (일관성)
- Isolation (격리성, 고립성)
- Durability (지속성)

<br/>

### 🔍 **원자성(Atomicity)**

트랜잭션이 DB에 모두 반영되던가, 아니면 전혀 반영되지 않아야 함을 의미 즉, 중간 단계까지만 실행되고 실패하는 일이 없어야 한다.

> **원자성이란 트랜잭션이 안전성 보장을 위해 가져야 할 성질 중의 하나이다.**


>**<span style="color:#3366ff">원자성</span>이란 시스템에서  <span style="color:#ff6600">한 트랜잭션의 연산들이 모두 성공하거나, 반대로 전부 실패되는 성질</span>을 말한다.**

> **원자성은 작업이 모두 반영되거나 모두 반영되지 않음으로서 결과를 예측할 수 있어야 한다.**

- 하나의 단위로 묶여있는 여러 작업이 부분적으로 실행된다면, 업데이트가 일어났지만 누가 업데이트했는지 모르거나, 업데이트 날짜가 누락되는 등 데이터가 오염될 수 있다.

- 예를 들어 계좌이체를 할 때에는 다음과 같은 두 단계가 있다.
    1. A 계좌에서 출금한다.
    2. B 계좌에 입금한다.


-  계좌이체를 하려는데 A 계좌에서는 출금이 이뤄지고, B 계좌에 입금되지 않았다고 가정한다.

- 어디서 문제가 발생했는지 파악할 수 없다면, A 계좌에서 출금된 돈은 세상에서 사라지는 돈이 된다.

- 만약 은행에서 이런 일이 발생한다면, 은행은 더이상 제 기능을 할 수 없을 것이다다.

- A 계좌에서 출금하는 일에 성공했지만, B 계좌에 입금하는 작업에 실패한다면 계좌 A에서 출금하는 작업을 포함하여 모든 작업이 실패로 돌아가야 한다는 것이 Atomicity(원자성)이다.

- 원자성을 지켰다면 1번과 2번, 두 작업이 모두 성공적으로 완료되어야 한다.

- 그렇지 않으면(둘 중 하나의 작업이라도 실패한다면), 하나의 단위로 묶여있는 모든 작업이 실패하게 만들어 기존 데이터를 보호한다. (롤백 시킨다.)

- SQL에서도 마찬가지이다.

- 특정 쿼리를 실행했는데 부분적으로 실패하는 부분이 있다면, 전부 실패하도록 구현되어 있다.

- 때때로 충돌 요인에 대해서 선택지를 제공한다.

<br/>

### 🔍 **일관성(Consistency)**

트랜잭션이 성공적으로 완료되면, DB가 일관된 상태를 유지해야 한다. 

예를 들어, 계좌 이체는 송금자와 수신자 계좌의 총액이 변하지 않는 것처럼.

> **일관성은 데이터베이스의 상태가 일관되어야 한다는 성질이다.**

**<span style="color:#3366ff">일관성</span>은 하나의  <span style="color:#ff6600">트랜잭션 이전과 이후, 데이터베이스의 상태는 이전과 같이 유효</span>해야 한다.**

> **다시 말해, 트랜잭션이 일어난 이후의 데이터베이스는 데이터베이스의 제약이나 규칙을 만족해야 한다는 뜻이다.**


- 예를 들어 ‘모든 고객은 반드시 이름을 가지고 있어야 한다’는 데이터베이스의 제약이 있다고 가정한다.

- 다음과 같은 트랜잭션은 Consistency(일관성)를 위반한다.
    - 이름 없는 새로운 고객을 추가하는 쿼리
    - 기존 고객의 이름을 삭제하는 쿼리


- 데이터베이스의 유효한 상태는 다를수 있지만, 데이터의 상태에 대한 일관성은 변하지 않아야 한다.

- 이 예시는 ‘이름이 있어야 한다’ 라는 제약을 위반한다.

- 따라서 예시 트랜잭션이 일어난 이후의 데이터베이스는 일관되지 않는 상태를 가지게 된다.

<br/>

### 🔍 **고립성/격리성(Isolation)**

동시에 실행되는 트랜잭션들이 서로 영향을 주지 않아야 한다. 

즉, 어떤 트랜잭션도 중간 단계의 결과를 볼 수 없어야 한다.

>**<span style="color:#3366ff">격리성</span>은 <span style="color:#ff6600">모든 트랜잭션은 다른 트랜잭션으로 부터 독립</span>되어야 한다는 뜻이다.**

> **실제로 동시에 여러 개의 트랜잭션들이 수행될 때, 각 트랜잭션은 고립(격리)되어 있어 연속으로 실행된 것과 동일한 결과를 나타낸다.**

- 예를 들어 게좌에 만 원이 있다고 가정한다.

- 이 계좌로부터 계좌 B로 6천 원을, 계좌 C로 6천 원을 동시에 계좌 이체하는 경우, 계좌 B에 먼저 송금한 뒤 계좌 C에 보내는 결과와 동일해야 한다.

- 동시에 트랜잭션을 실행한다고 해서 계좌 B와 C에 각각 6천 원씩 송금하여 마이너스 통장이 되는 것이 아니다.

- 각각의 송금 작업을 연속으로 실행하는 것과 동일한 결과가 나타나야 한다.

- 격리성을 지키는 각 트랜젝션은 철저히 독립적이기 때문에, 다른 트랜젝션의 작업 내용을 알 수 없다.

-  그리고 트랜잭션이 동시에 실행될 때와 연속으로 실행될 때의 데이터베이스 상태가 동일해야 한다.

<br/>

### 🔍 **지속성(Durability)**

성공적으로 완료된 트랜잭션의 결과는 영구적으로 반영되어야 한다.


>**<span style="color:#3366ff">지속성</span>은 하나의 트랜잭션이 성공적으로 수행되었다면, 해당 <span style="color:#ff6600">트랜잭션에 대한 로그가 남아야하는 성징</span>이다.**

> **만약 런타임 오류나 시스템 오류가 발생하더라도, 해당 기록은 영구적이어야 한다는 뜻이다.**

- 예를 들어 은행에서 게좌이체를 성공적으로 실행한 뒤에, 해당 은행 데이터베이스에 오류가 발생해 종료되더라도 계좌이체 내역은 기록으로 남아야 한다.

- 마찬가지로 계좌이체를 로그로 기록하기 전에 시스템 오류 등에 의해 종료가 된다면, 해당 이체 내역은 실패로 돌아가고 각 계좌들은 계좌이체 이전 상태들로 돌아가게 된다.

<br/>

## 💻 **4.2 NULL**

>**<span style="color:#3366ff">NULL</span>은 <span style="color:#ff6600">'값이 없음', '미정'의 개념</span>으로 이해할 수 있다.**

- 예를 들어, 친구와 약속장소를 정하지 않았다고 생각해보자. 

- 친구와 "어디서 만날까?"라는 질문에 대답하기 어렵다. 

- 왜냐하면 아직 약속장소를 정하지 않았기 때문이다. 

- 같은 방식으로 데이터베이스에서 `NULL` 값은 "`아직 정보가 없거나 알려지지 않음`" 혹은 "`적용되지 않음`"을 나타낸다. 


|생년월일|이름|수입|지출|직업|
|:-:|:-:|:-:|:-:|:-:|
|20000101|강산|0|10000|대학생|
|19921231|이로운|NULL|20000|프리랜서|
|19900402|이꼬비|100000|50000|개발자|

위 데이터에서 강산의 수입은 0원이지만 프리랜서 이로운의 수입은 NULL이다. 

얼핏보면 같아 보일 수도 있지만 두 개의 데이터가 갖는 의미는 엄연히 다르다. 

결론적으로 이로운의 수입은 0원일 수도 있고 수천만 원일 수도 있다. 

어떠한 사유로 데이터가 입력되지 않아 NULL 값이 된 것이다.


### 1️⃣ **SELECT 수입 - 지출 FROM 테이블**

|생년월일|이름|수입|지출|직업|
|:-:|:-:|:-:|:-:|:-:|
|20000101|강산|0|10000|대학생|
|19921231|이로운|`NULL`|`20000`|프리랜서|
|19900402|이꼬비|100000|50000|개발자|

> 가로 연산 : NULL이 포함되어 있으면 결과값은 NULL이 된다. 

### 2️⃣ **SELECT SUM(수입) FROM 테이블**

|생년월일|이름|수입|지출|직업|
|:-:|:-:|:-:|:-:|:-:|
|20000101|강산|0|`10000`|대학생|
|19921231|이로운|`NULL`|20000|프리랜서|
|19900402|이꼬비|`100000`|50000|개발자|

> 새로 연산 : 다른 인스턴스의 데이터와 연산할 때는 NULL 값을 제외한다.


<br/>

# 📚 **레퍼런스**

> 정미나. (유튜브 선생님에게 배우는) 유선배 SQL개발자(SQLD) 과외노트 / [정미나 저] (2023). Print.
{:.prompt-info }


> 한국데이터산업진흥원. SQL 자격검정 실전문제 : 국가공인 SQL전문가·국가공인 SQL개발자 / 한국데이터산업진흥원 [편] (2020). Print.
{:.prompt-info }

> [SQL 개발자 (SQLD) 자격증 따기 Part.1 / [유용한IT학습] ](https://www.inflearn.com/course/sqld-%EC%9E%90%EA%B2%A9%EC%A6%9D-%EC%B4%88%EA%B8%89-1/dashboard){:target="_blank"}
{:.prompt-info }

> [[데이터베이스] 트랜잭션의 ACID 성질 / [HANAMON] ](https://hanamon.kr/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-acid-%EC%84%B1%EC%A7%88/){:target="_blank"}
{:.prompt-info }
